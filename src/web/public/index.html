<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§‹é€ çš„å¯¾è©±ãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 24px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main {
            padding: 32px;
        }
        
        .input-section {
            margin-bottom: 32px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }
        
        .controls {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #4f46e5;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .settings-toggle {
            margin-left: auto;
        }
        
        .settings {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .settings.open {
            display: block;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
        }
        
        .setting-item label {
            font-size: 12px;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .setting-item input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
        }
        
        .results {
            margin-top: 32px;
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .summary {
            background: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
        }
        
        .summary-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .chunk {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .chunk-header {
            background: #f9fafb;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chunk-title {
            font-weight: 600;
            color: #374151;
        }
        
        .chunk-meta {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .chunk-content {
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .chunk-content pre {
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }
        
        .error.show {
            display: block;
        }
        
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 12px;
            transition: background-color 0.2s;
        }
        
        .copy-btn:hover {
            background: #2563eb;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ æ§‹é€ çš„å¯¾è©±ãƒ„ãƒ¼ãƒ« v5.0</h1>
            <p>Phase 2é©å‘½çš„æ©Ÿèƒ½: æ–‡è„ˆé‡è¦åº¦ãƒ»å‹•çš„å­¦ç¿’ãƒ»äºˆæ¸¬çš„æ¦‚å¿µæŠ½å‡º</p>
        </div>
        
        <div class="main">
            <div class="input-section">
                <div class="form-group">
                    <label for="rawLog">ğŸ—£ï¸ ç”Ÿãƒ­ã‚°ï¼ˆAIã¨ã®å¯¾è©±ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ï¼‰</label>
                    <textarea 
                        id="rawLog" 
                        placeholder="User: ã“ã‚“ã«ã¡ã¯&#10;&#10;Assistant: ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ&#10;&#10;User: æ§‹é€ çš„å¯¾è©±ã«ã¤ã„ã¦æ•™ãˆã¦..."
                    ></textarea>
                </div>
                
                <div class="form-group">
                    <label for="sessionContext">ğŸ”— ã‚»ãƒƒã‚·ãƒ§ãƒ³æ–‡è„ˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                    <textarea 
                        id="sessionContext" 
                        style="min-height: 100px;"
                        placeholder="ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èƒŒæ™¯æƒ…å ±ã€å‰å›ã‹ã‚‰ã®ç¶™ç¶šäº‹é …ãªã©..."
                    ></textarea>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="processUnified()">
                        âœ¨ çµ±ä¸€å‡¦ç†ï¼ˆæ¨å¥¨ï¼‰
                    </button>
                    <button class="btn btn-secondary" onclick="processLog()">
                        ğŸš€ å¾“æ¥å‡¦ç†
                    </button>
                    <button class="btn btn-secondary" onclick="extractConcepts()">
                        ğŸ§  æ¦‚å¿µæŠ½å‡º
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">
                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                    </button>
                    <button class="btn btn-secondary settings-toggle" onclick="toggleSettings()">
                        âš™ï¸ è¨­å®š
                    </button>
                </div>
                
                <!-- NEW: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                <div class="session-controls" style="margin-top: 20px; padding: 16px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                    <h3 style="color: #0c4a6e; margin-bottom: 12px;">ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h3>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                        <button class="btn btn-secondary" onclick="startNewSession()" id="startNewBtn">
                            ğŸ”— å‰å›ã‹ã‚‰ç¶™ç¶šé–‹å§‹
                        </button>
                        <button class="btn btn-secondary" onclick="showSessionDashboard()" id="dashboardBtn">
                            ğŸ“Š ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
                        </button>
                        <button class="btn btn-secondary" onclick="getLatestHandover()" id="handoverBtn">
                            ğŸ”„ å¼•ãç¶™ãç¢ºèª
                        </button>
                    </div>
                    <div id="sessionStatus" style="margin-top: 12px; font-size: 14px; color: #6b7280;">
                        ğŸ’¡ ãƒ’ãƒ³ãƒˆ: çµ±ä¸€å‡¦ç†å®Ÿè¡Œå¾Œã«è‡ªå‹•çš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>
                
                <div class="settings" id="settings">
                    <h3>âš™ï¸ å‡¦ç†è¨­å®š</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>ç›®æ¨™ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º</label>
                            <input type="number" id="targetChunkSize" value="10000" min="1000" max="50000">
                        </div>
                        <div class="setting-item">
                            <label>æ–‡è„ˆä¿æŒ</label>
                            <input type="checkbox" id="preserveContext" checked>
                        </div>
                        <div class="setting-item">
                            <label>ãƒãƒ£ãƒ³ã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ </label>
                            <input type="checkbox" id="addChunkHeaders" checked>
                        </div>
                        <div class="setting-item">
                            <label>ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ</label>
                            <input type="checkbox" id="generateFilenames" checked>
                        </div>
                        <div class="setting-item">
                            <label>æ›¸å¼çµ±ä¸€</label>
                            <input type="checkbox" id="unifyFormat" checked>
                        </div>
                        <div class="setting-item">
                            <label>ä¸¦åˆ—å‡¦ç† (æ€§èƒ½å‘ä¸Š)</label>
                            <input type="checkbox" id="parallelProcessing" checked>
                        </div>
                        <div class="setting-item">
                            <label>ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º (KB)</label>
                            <input type="number" id="chunkSize" value="15" min="5" max="100" style="width: 60px;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ãƒ­ã‚°ã‚’å‡¦ç†ä¸­...</p>
            </div>
            
            <div class="error" id="error"></div>
            
            <div class="results" id="results">
                <div class="summary" id="summary"></div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('chunks')">ğŸ“¦ åˆ†å‰²çµæœ</div>
                    <div class="tab" onclick="switchTab('prompts')">ğŸ’¬ æ§‹é€ åŒ–ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                    <div class="tab" onclick="switchTab('unified')">âœ¨ çµ±ä¸€æ›¸å¼</div>
                    <div class="tab" onclick="switchTab('concepts')">ğŸš€ æ¦‚å¿µæŠ½å‡º v5.0</div>
                    <div class="tab" onclick="switchTab('predictions')">ğŸ”® äºˆæ¸¬åˆ†æ [Phase 3]</div>
                    <div class="tab" onclick="switchTab('ai-analysis')">ğŸ¤– AIçµ±åˆåˆ†æ [Phase 5]</div>
                    <div class="tab" onclick="switchTab('learning')">ğŸ“š å­¦ç¿’çµ±è¨ˆ [NEW]</div>
                    <div class="tab" onclick="switchTab('metrics')">ğŸ“Š å“è³ªåˆ†æ</div>
                    <div class="tab" onclick="switchTab('sessions')">ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</div>
                </div>
                
                <div class="tab-content active" id="chunks-content"></div>
                <div class="tab-content" id="prompts-content"></div>
                <div class="tab-content" id="unified-content"></div>
                <div class="tab-content" id="concepts-content"></div>
                <div class="tab-content" id="predictions-content"></div>
                <div class="tab-content" id="ai-analysis-content"></div>
                <div class="tab-content" id="learning-content"></div>
                <div class="tab-content" id="metrics-content"></div>
                <div class="tab-content" id="sessions-content"></div>
            </div>
        </div>
    </div>

    <script>
        let currentResults = null;

        function toggleSettings() {
            const settings = document.getElementById('settings');
            settings.classList.toggle('open');
        }

        function clearAll() {
            document.getElementById('rawLog').value = '';
            document.getElementById('sessionContext').value = '';
            document.getElementById('results').classList.remove('show');
            document.getElementById('error').classList.remove('show');
        }

        function switchTab(tabName) {
            try {
                console.log('Switching to tab:', tabName);
                
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                event.target.classList.add('active');
                const targetContent = document.getElementById(tabName + '-content');
                if (targetContent) {
                    targetContent.classList.add('active');
                } else {
                    console.error('Tab content not found:', tabName + '-content');
                }
                
                // ã‚¿ãƒ–å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
                if (tabName === 'learning') {
                    displayLearningStats();
                } else if (tabName === 'ai-analysis') {
                    initializeAIAnalysisTab();
                }
                
                console.log('Tab switch completed:', tabName);
            } catch (error) {
                console.error('Error switching tab:', error);
            }
        }

        async function processUnified() {
            const rawLog = document.getElementById('rawLog').value.trim();
            const sessionContext = document.getElementById('sessionContext').value.trim();
            
            if (!rawLog) {
                showError('ç”Ÿãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ç®¡ç†ãƒ»é‡è¤‡ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢
            const unifiedButton = document.querySelector('button[onclick="processUnified()"]');
            const originalText = unifiedButton.textContent;
            unifiedButton.disabled = true;
            unifiedButton.textContent = 'ğŸ”„ å‡¦ç†ä¸­... (é«˜é€ŸåŒ–æ¸ˆã¿)';
            
            // é€²æ—è¡¨ç¤ºå¼·åŒ–
            const loading = document.getElementById('loading');
            const loadingText = loading.querySelector('p');
            loadingText.textContent = 'âš¡ çµ±åˆå‡¦ç†å®Ÿè¡Œä¸­... (é‡è¤‡å‡¦ç†ä¿®æ­£æ¸ˆã¿)';
            
            showLoading(true);
            hideError();
            
            const startTime = Date.now();

            try {
                // UIè¨­å®šã‹ã‚‰å‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å–å¾—
                const processingOptions = {
                    parallelProcessing: document.getElementById('parallelProcessing').checked,
                    chunkSize: parseInt(document.getElementById('chunkSize').value) * 1000, // KBâ†’ãƒã‚¤ãƒˆå¤‰æ›
                    maxParallelChunks: 4 // å›ºå®šå€¤
                };
                
                console.log('ğŸ“Š çµ±åˆå‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³:', processingOptions);
                
                const response = await fetch('/api/process-unified', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        rawLog,
                        sessionContext: sessionContext || undefined,
                        options: processingOptions
                    })
                });

                const result = await response.json();

                if (result.success) {
                    const processingTime = Date.now() - startTime;
                    console.log(`âœ… çµ±åˆå‡¦ç†å®Œäº†: ${processingTime}ms (æ€§èƒ½æ”¹å–„æ¸ˆã¿)`);
                    
                    currentResults = result;
                    displayUnifiedResults(result);
                } else {
                    showError(result.error || 'å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showError('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                showLoading(false);
                
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹å¾©å…ƒ
                unifiedButton.disabled = false;
                unifiedButton.textContent = originalText;
                loadingText.textContent = 'ãƒ­ã‚°ã‚’å‡¦ç†ä¸­...';
            }
        }

        async function processLog() {
            const rawLog = document.getElementById('rawLog').value.trim();
            const sessionContext = document.getElementById('sessionContext').value.trim();
            
            if (!rawLog) {
                showError('ç”Ÿãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const options = {
                targetChunkSize: parseInt(document.getElementById('targetChunkSize').value),
                preserveContext: document.getElementById('preserveContext').checked,
                addChunkHeaders: document.getElementById('addChunkHeaders').checked,
                generateFilenames: document.getElementById('generateFilenames').checked,
                unifyFormat: document.getElementById('unifyFormat').checked
            };

            showLoading(true);
            hideError();

            try {
                const response = await fetch('/api/process-log', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        rawLog,
                        sessionContext: sessionContext || undefined,
                        options
                    })
                });

                const result = await response.json();

                if (result.success) {
                    currentResults = result;
                    displayResults(result);
                } else {
                    showError(result.error || 'å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showError('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayUnifiedResults(result) {
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.originalLength.toLocaleString()}</div>
                        <div class="summary-label">å…ƒã®æ–‡å­—æ•°</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.chunkCount}</div>
                        <div class="summary-label">ãƒãƒ£ãƒ³ã‚¯æ•°</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.processingTime}ms</div>
                        <div class="summary-label">å‡¦ç†æ™‚é–“</div>
                    </div>
                    <div class="summary-item unified-feature">
                        <div class="summary-value">âœ¨</div>
                        <div class="summary-label">çµ±ä¸€å‡¦ç†</div>
                    </div>
                </div>
                
                <div class="unified-header" style="margin-top: 20px; padding: 16px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                    <h3 style="color: #0c4a6e; margin-bottom: 12px;">ğŸ“‹ ${result.unified.header.title}</h3>
                    <p><strong>ä¸»è¦æ¦‚å¿µ:</strong> ${result.unified.header.mainConcepts.join(', ')}</p>
                    <p><strong>è­°è«–ç¯„å›²:</strong> ${result.unified.header.discussionScope}</p>
                    <p><strong>å¯¾è©±å½¢å¼:</strong> ${result.unified.header.dialogueType}</p>
                    <p><strong>æ¨å¥¨ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${result.unified.header.suggestedFilename}</p>
                </div>
            `;

            const chunksContent = document.getElementById('chunks-content');
            chunksContent.innerHTML = result.unified.chunks.map((chunk, index) => `
                <div class="chunk">
                    <div class="chunk-header">
                        <div class="chunk-title">ãƒãƒ£ãƒ³ã‚¯ ${chunk.index}/${result.summary.chunkCount}</div>
                        <div class="chunk-meta">
                            æ–‡å­—ç¯„å›²: ${chunk.characterRange}
                            <button class="copy-btn" onclick="copyToClipboard(\`${chunk.continuationPrompt.replace(/`/g, '\\`')}\`, this)">
                                ğŸš€ AIã«é€ä¿¡ï¼ˆå®Œå…¨ç‰ˆï¼‰
                            </button>
                        </div>
                    </div>
                    <div class="chunk-content">
                        <h4>ğŸ¯ AIé€ä¿¡ç”¨å®Œå…¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæŒ‡ç¤º + å®Ÿéš›ã®ãƒ­ã‚°å†…å®¹ï¼‰</h4>
                        <p style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">
                            ã€ŒğŸš€ AIã«é€ä¿¡ï¼ˆå®Œå…¨ç‰ˆï¼‰ã€ãƒœã‚¿ãƒ³ã§ã€ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’Claude/ChatGPTã«ç›´æ¥è²¼ã‚Šä»˜ã‘ã¦æ§‹é€ åŒ–ã§ãã¾ã™
                        </p>
                        <pre style="max-height: 300px; overflow-y: auto;">${escapeHtml(chunk.continuationPrompt)}</pre>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                            <h4>ğŸ“„ åˆ†å‰²å¾Œã®åŸæ–‡ï¼ˆå‚è€ƒç”¨ï¼‰</h4>
                            <button class="copy-btn btn-secondary" onclick="copyToClipboard(\`${chunk.content.replace(/`/g, '\\`').replace(/\\/g, '\\\\')}\`, this)" style="background: #6b7280;">
                                ğŸ“„ åŸæ–‡ã®ã¿ã‚³ãƒ”ãƒ¼
                            </button>
                        </div>
                        <pre style="max-height: 400px; overflow-y: auto; background: #f8f9fa; white-space: pre-wrap;">${escapeHtml(chunk.content)}</pre>
                    </div>
                </div>
            `).join('');

            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ãƒ–ã«çµ±ä¸€å‡ºåŠ›ã‚’è¡¨ç¤º
            const promptsContent = document.getElementById('prompts-content');
            promptsContent.innerHTML = `
                <div style="margin-bottom: 20px; padding: 16px; background: #ecfdf5; border-radius: 8px;">
                    <h3 style="color: #065f46;">ğŸš€ ç°¡å˜3ã‚¹ãƒ†ãƒƒãƒ—ã§æ§‹é€ åŒ–</h3>
                    <ol style="margin: 12px 0; padding-left: 20px;">
                        <li>å„ãƒãƒ£ãƒ³ã‚¯ã®ã€ŒğŸš€ AIã«é€ä¿¡ï¼ˆå®Œå…¨ç‰ˆï¼‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>Claude/ChatGPTã«è²¼ã‚Šä»˜ã‘ã¦ã‚¨ãƒ³ã‚¿ãƒ¼</li>
                        <li>æ§‹é€ åŒ–å®Œäº†ï¼</li>
                    </ol>
                    <p style="color: #065f46; font-weight: 500;">â€» ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¯æŒ‡ç¤º + å®Ÿéš›ã®ãƒ­ã‚°å†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™</p>
                </div>
                <pre style="white-space: pre-wrap; font-size: 13px; line-height: 1.5;">${escapeHtml(result.unified.output)}</pre>
            `;

            // çµ±ä¸€æ›¸å¼ã‚¿ãƒ–ã«çµ±ä¸€å‡ºåŠ›ã‚’è¡¨ç¤º
            const unifiedContent = document.getElementById('unified-content');
            unifiedContent.innerHTML = `
                <div style="margin-bottom: 20px; padding: 16px; background: #fef3c7; border-radius: 8px;">
                    <h3 style="color: #92400e;">ğŸ“ æ¨å¥¨ãƒ•ã‚¡ã‚¤ãƒ«å: ${result.unified.header.suggestedFilename}</h3>
                    <p>çµ±ä¸€å‡¦ç†ã«ã‚ˆã‚Šã€ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å…¨ä½“ã‚’ç®¡ç†ã§ãã¾ã™ã€‚</p>
                </div>
                <pre style="white-space: pre-wrap; font-size: 13px; line-height: 1.5;">${escapeHtml(result.unified.output)}</pre>
            `;

            // å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¿ãƒ–ã«å“è³ªåˆ†æçµæœã‚’è¡¨ç¤º
            const metricsContent = document.getElementById('metrics-content');
            if (result.unified.qualityMetrics) {
                const metrics = result.unified.qualityMetrics;
                metricsContent.innerHTML = `
                    <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; border-left: 4px solid #0ea5e9;">
                        <h2 style="color: #0c4a6e; margin-bottom: 16px; display: flex; align-items: center;">
                            ğŸ“Š å“è³ªåˆ†æãƒ¬ãƒãƒ¼ãƒˆ
                            <span style="margin-left: auto; font-size: 1.8rem; font-weight: bold; color: ${getScoreColor(metrics.overallScore)};">
                                ${metrics.overallScore.toFixed(1)}/100
                            </span>
                        </h2>
                        <p style="color: #075985; margin-bottom: 0;">çµ±ä¸€ãƒ­ã‚°å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®åŠ¹æœã‚’å®šé‡çš„ã«åˆ†æ</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
                        <!-- æ¦‚å¿µæ¤œå‡ºèƒ½åŠ› -->
                        <div style="background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #065f46; margin-bottom: 12px;">ğŸ” æ¦‚å¿µæ¤œå‡ºèƒ½åŠ›</h3>
                            <div style="space-y: 8px;">
                                <div><strong>æ¤œå‡ºæ¦‚å¿µæ•°:</strong> ${metrics.conceptDetection.detectedConceptsCount}å€‹</div>
                                <div><strong>æ¦‚å¿µå¯†åº¦:</strong> ${metrics.conceptDetection.conceptDensity.toFixed(3)}/ä¸‡æ–‡å­—</div>
                                <div><strong>æ¦‚å¿µã‚«ãƒãƒ¬ãƒƒã‚¸:</strong> ${metrics.conceptDetection.conceptCoverage.toFixed(1)}%</div>
                                <div><strong>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒç‡:</strong> ${metrics.conceptDetection.keywordMatchRate.toFixed(1)}%</div>
                                <div><strong>æ¦‚å¿µä¸€è²«æ€§:</strong> ${metrics.conceptDetection.conceptCoherence.toFixed(1)}%</div>
                            </div>
                        </div>

                        <!-- å‡¦ç†æ€§èƒ½ -->
                        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #92400e; margin-bottom: 12px;">âš¡ å‡¦ç†æ€§èƒ½</h3>
                            <div style="space-y: 8px;">
                                <div><strong>ç·å‡¦ç†æ™‚é–“:</strong> ${metrics.processingPerformance.totalProcessingTime}ms</div>
                                <div><strong>ãƒãƒ£ãƒ³ã‚¯å‡¦ç†æ™‚é–“:</strong> ${metrics.processingPerformance.chunkProcessingTime}ms</div>
                                <div><strong>æ¦‚å¿µæŠ½å‡ºæ™‚é–“:</strong> ${metrics.processingPerformance.conceptExtractionTime}ms</div>
                                <div><strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:</strong> ${metrics.processingPerformance.memoryUsage.toFixed(2)}MB</div>
                                <div><strong>ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ:</strong> ${metrics.processingPerformance.throughput.toFixed(0)}æ–‡å­—/ç§’</div>
                            </div>
                        </div>

                        <!-- æ§‹é€ å“è³ª -->
                        <div style="background: #fdf2f8; border: 1px solid #ec4899; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #831843; margin-bottom: 12px;">ğŸ—ï¸ æ§‹é€ å“è³ª</h3>
                            <div style="space-y: 8px;">
                                <div><strong>ãƒãƒ£ãƒ³ã‚¯ãƒãƒ©ãƒ³ã‚¹:</strong> ${metrics.structuralQuality.chunkBalanceScore.toFixed(1)}%</div>
                                <div><strong>æ–‡è„ˆä¿æŒ:</strong> ${metrics.structuralQuality.contextPreservationScore.toFixed(1)}%</div>
                                <div><strong>ãƒãƒ£ãƒ³ã‚¯ä¸€è²«æ€§:</strong> ${metrics.structuralQuality.chunkCoherenceScore.toFixed(1)}%</div>
                                <div><strong>ãƒ˜ãƒƒãƒ€ãƒ¼ç²¾åº¦:</strong> ${metrics.structuralQuality.headerAccuracy.toFixed(1)}%</div>
                                <div><strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Œå…¨æ€§:</strong> ${metrics.structuralQuality.promptCompleteness.toFixed(1)}%</div>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px;">
                        <h3 style="color: #334155; margin-bottom: 12px;">ğŸ“ˆ ã‚¹ã‚³ã‚¢è©•ä¾¡åŸºæº–</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; text-align: center;">
                            <div style="padding: 8px; background: #dcfce7; border-radius: 6px; color: #166534;">
                                <strong>85+</strong><br>å„ªç§€
                            </div>
                            <div style="padding: 8px; background: #fef3c7; border-radius: 6px; color: #92400e;">
                                <strong>70-84</strong><br>è‰¯å¥½
                            </div>
                            <div style="padding: 8px; background: #fed7d7; border-radius: 6px; color: #b91c1c;">
                                <strong>50-69</strong><br>æ”¹å–„è¦
                            </div>
                            <div style="padding: 8px; background: #f1f5f9; border-radius: 6px; color: #475569;">
                                <strong>50æœªæº€</strong><br>è¦è¦‹ç›´ã—
                            </div>
                        </div>
                    </div>
                `;
            } else {
                metricsContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <h3>å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“</h3>
                        <p>çµ±ä¸€å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰å“è³ªåˆ†æã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
                    </div>
                `;
            }

            // æ¦‚å¿µæŠ½å‡ºçµæœã‚’è¡¨ç¤º
            if (result.extraction) {
                displayConceptResults(result);
            }

            // å‡¦ç†çµæœã‚’ä¿å­˜
            lastProcessedResults = result;
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ã«è¿½åŠ 
            showSessionSaveOption(result);

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function displayResults(result) {
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.originalLength.toLocaleString()}</div>
                        <div class="summary-label">å…ƒã®æ–‡å­—æ•°</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.chunkCount}</div>
                        <div class="summary-label">ãƒãƒ£ãƒ³ã‚¯æ•°</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.avgChunkSize.toLocaleString()}</div>
                        <div class="summary-label">å¹³å‡ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.processingTime}ms</div>
                        <div class="summary-label">å‡¦ç†æ™‚é–“</div>
                    </div>
                </div>
            `;

            const chunksContent = document.getElementById('chunks-content');
            chunksContent.innerHTML = result.chunks.map(chunk => `
                <div class="chunk">
                    <div class="chunk-header">
                        <div class="chunk-title">ãƒãƒ£ãƒ³ã‚¯ ${chunk.index}</div>
                        <div class="chunk-meta">
                            ${chunk.metadata.characterCount}æ–‡å­— | 
                            ${chunk.suggestedFilename || 'ãƒ•ã‚¡ã‚¤ãƒ«åæœªç”Ÿæˆ'}
                        </div>
                    </div>
                    <div class="chunk-content">
                        <pre>${escapeHtml(chunk.content.substring(0, 1000))}${chunk.content.length > 1000 ? '...' : ''}</pre>
                    </div>
                </div>
            `).join('');

            document.getElementById('results').classList.add('show');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }

        function copyToClipboard(text, element) {
            try {
                // elementãŒæ¸¡ã•ã‚Œãªã„å ´åˆã¯event.targetã‚’ä½¿ç”¨ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
                const button = element || (typeof event !== 'undefined' ? event.target : null);
                
                if (!navigator.clipboard) {
                    throw new Error('Clipboard API not supported');
                }
                
                navigator.clipboard.writeText(text).then(() => {
                    if (button) {
                        // ä¸€æ™‚çš„ã«æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                        const originalText = button.textContent;
                        button.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†';
                        button.style.background = '#10b981';
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.style.background = '';
                        }, 2000);
                    }
                }).catch(err => {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:', err);
                    showError('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err.message);
                });
            } catch (err) {
                console.error('ã‚³ãƒ”ãƒ¼é–¢æ•°ã‚¨ãƒ©ãƒ¼:', err);
                showError('ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“: ' + err.message);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getScoreColor(score) {
            if (score >= 85) return '#059669'; // ç·‘ï¼ˆå„ªç§€ï¼‰
            if (score >= 70) return '#d97706'; // ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆè‰¯å¥½ï¼‰
            if (score >= 50) return '#dc2626'; // èµ¤ï¼ˆæ”¹å–„è¦ï¼‰
            return '#6b7280'; // ã‚°ãƒ¬ãƒ¼ï¼ˆè¦è¦‹ç›´ã—ï¼‰
        }

        // IntelligentConceptExtractor æ¦‚å¿µæŠ½å‡ºæ©Ÿèƒ½
        async function extractConcepts() {
            const rawLog = document.getElementById('rawLog').value.trim();
            
            if (!rawLog) {
                showError('ç”Ÿãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showLoading(true);
            hideError();

            try {
                // UIè¨­å®šã‹ã‚‰å‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å–å¾—
                const processingOptions = {
                    parallelProcessing: document.getElementById('parallelProcessing').checked,
                    chunkSize: parseInt(document.getElementById('chunkSize').value) * 1000, // KBâ†’ãƒã‚¤ãƒˆå¤‰æ›
                    maxParallelChunks: 4 // å›ºå®šå€¤
                };
                
                console.log('ğŸ“Š å‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³:', processingOptions);
                
                const response = await fetch('/api/extract-concepts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        logContent: rawLog,
                        options: processingOptions
                    })
                });

                const result = await response.json();

                if (result.success) {
                    displayConceptResults(result);
                } else {
                    showError(result.error || 'æ¦‚å¿µæŠ½å‡ºä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showError('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayConceptResults(result) {
            const extraction = result.extraction;
            
            // ã‚µãƒãƒªãƒ¼æ›´æ–°
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.originalLength.toLocaleString()}</div>
                        <div class="summary-label">å…ƒã®æ–‡å­—æ•°</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" style="color: ${getInnovationColor(extraction.predictedInnovationLevel)};">
                            ${extraction.predictedInnovationLevel}/10
                        </div>
                        <div class="summary-label">é©æ–°åº¦äºˆæ¸¬</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${extraction.predictedSocialImpact.toUpperCase()}</div>
                        <div class="summary-label">ç¤¾ä¼šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${result.summary.processingTime}ms</div>
                        <div class="summary-label">å‡¦ç†æ™‚é–“</div>
                    </div>
                </div>
            `;

            // æ¦‚å¿µæŠ½å‡ºçµæœã‚¿ãƒ–ã«è©³ç´°ã‚’è¡¨ç¤º
            const conceptsContent = document.getElementById('concepts-content');
            conceptsContent.innerHTML = `
                <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px;">
                    <h2 style="color: #0c4a6e; margin-bottom: 16px; display: flex; align-items: center;">
                        ğŸ§  IntelligentConceptExtractor v2.0 çµæœ
                        <span style="margin-left: auto; font-size: 1.8rem; font-weight: bold; color: ${getInnovationColor(extraction.predictedInnovationLevel)};">
                            é©æ–°åº¦ ${extraction.predictedInnovationLevel}/10
                        </span>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div><strong>å¯¾è©±ã‚¿ã‚¤ãƒ—:</strong> ${extraction.dialogueTypeDetection}</div>
                        <div><strong>ç¤¾ä¼šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:</strong> ${extraction.predictedSocialImpact}</div>
                        <div><strong>çªç ´ç¢ºç‡:</strong> ${extraction.breakthroughProbability.toFixed(1)}%</div>
                        <div><strong>ä¿¡é ¼åº¦:</strong> ${extraction.confidence.toFixed(1)}%</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 24px;">
                    <!-- æ·±å±¤æ¦‚å¿µ -->
                    <div style="background: #fdf2f8; border: 1px solid #ec4899; border-radius: 8px; padding: 16px;">
                        <h3 style="color: #831843; margin-bottom: 12px;">ğŸŒŠ æ·±å±¤æ¦‚å¿µ (${extraction.deepConcepts.length}å€‹)</h3>
                        ${extraction.deepConcepts.map(concept => `
                            <div style="margin-bottom: 12px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid #ec4899;">
                                <strong>${concept.term}</strong>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                                    ä¿¡é ¼åº¦: ${Math.round(concept.confidence * 100)}% | ${concept.reasoning}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- è¡¨é¢æ¦‚å¿µ -->
                    <div style="background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 16px;">
                        <h3 style="color: #065f46; margin-bottom: 12px;">ğŸŒ¸ è¡¨é¢æ¦‚å¿µ (${extraction.surfaceConcepts.length}å€‹)</h3>
                        ${extraction.surfaceConcepts.map(concept => `
                            <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #10b981;">
                                <strong>${concept.term}</strong>
                                <span style="font-size: 12px; color: #6b7280; margin-left: 8px;">
                                    (${Math.round(concept.confidence * 100)}%)
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                ${extraction.timeRevolutionMarkers.length > 0 ? `
                    <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <h3 style="color: #92400e; margin-bottom: 12px;">âš¡ æ™‚é–“é©å‘½ãƒãƒ¼ã‚«ãƒ¼ (${extraction.timeRevolutionMarkers.length}å€‹)</h3>
                        ${extraction.timeRevolutionMarkers.map(marker => `
                            <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px;">
                                <strong>"${marker.timeExpression}"</strong> - ${marker.efficiency}
                                <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                                    ${marker.context.substring(0, 100)}...
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px;">
                    <h3 style="color: #334155; margin-bottom: 12px;">ğŸ“Š å“è³ªäºˆæ¸¬</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #059669;">${extraction.qualityPrediction.conceptDensity}%</div>
                            <div style="font-size: 12px; color: #6b7280;">æ¦‚å¿µå¯†åº¦</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #d97706;">${extraction.qualityPrediction.innovationPotential}%</div>
                            <div style="font-size: 12px; color: #6b7280;">é©æ–°ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #7c3aed;">${extraction.qualityPrediction.structuralDialogueScore}%</div>
                            <div style="font-size: 12px; color: #6b7280;">æ§‹é€ çš„å¯¾è©±ã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #dc2626;">${extraction.qualityPrediction.overallQuality}%</div>
                            <div style="font-size: 12px; color: #6b7280;">ç·åˆå“è³ª</div>
                        </div>
                    </div>
                </div>

                ${extraction.similarPatterns.length > 0 ? `
                    <div style="background: #f1f5f9; border: 1px solid #94a3b8; border-radius: 8px; padding: 16px; margin-top: 16px;">
                        <h3 style="color: #475569; margin-bottom: 12px;">ğŸ”— é¡ä¼¼ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                        ${extraction.similarPatterns.map(pattern => `
                            <div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">â€¢ ${pattern}</div>
                        `).join('')}
                    </div>
                ` : ''}
            `;

            // Phase 3: äºˆæ¸¬åˆ†æã‚¿ãƒ–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›´æ–°
            if (extraction.predictiveExtraction) {
                displayPredictiveAnalysis(extraction.predictiveExtraction, extraction);
            }

            // æ¦‚å¿µæŠ½å‡ºã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¦çµæœã‚’è¡¨ç¤º
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector('[onclick="switchTab(\'concepts\')"]').classList.add('active');
            document.getElementById('concepts-content').classList.add('active');

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * Phase 3: äºˆæ¸¬åˆ†æã®è¡¨ç¤º
         */
        function displayPredictiveAnalysis(predictiveExtraction, parentExtraction) {
            const predictionsContent = document.getElementById('predictions-content');
            
            predictionsContent.innerHTML = `
                <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #fef3c7, #fed7aa); border-radius: 12px;">
                    <h2 style="color: #92400e; margin-bottom: 16px; display: flex; align-items: center;">
                        ğŸ”® Phase 3: äºˆæ¸¬çš„æ¦‚å¿µæŠ½å‡ºãƒ»å‰µç™ºãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
                        <span style="margin-left: auto; font-size: 1rem; font-weight: normal; color: #a3a3a3;">
                            v${predictiveExtraction.analysisDepth || 3}.0
                        </span>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div><strong>æ½œåœ¨æ¦‚å¿µ:</strong> ${predictiveExtraction.predictedConcepts.length}å€‹</div>
                        <div><strong>å‰µç™ºãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${predictiveExtraction.emergentPatterns.length}å€‹</div>
                        <div><strong>éš ã‚ŒãŸæ¥ç¶š:</strong> ${predictiveExtraction.hiddenConnections.length}å€‹</div>
                        <div><strong>åˆ†ææ·±åº¦:</strong> Level ${predictiveExtraction.analysisDepth || 3}</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                    <!-- äºˆæ¸¬æ¦‚å¿µã®å¯è¦–åŒ– -->
                    <div style="background: #fdf4ff; border: 1px solid #c084fc; border-radius: 8px; padding: 16px;">
                        <h3 style="color: #581c87; margin-bottom: 12px;">ğŸ”® äºˆæ¸¬ã•ã‚ŒãŸæ½œåœ¨æ¦‚å¿µ</h3>
                        <div id="predicted-concepts-viz" style="max-height: 400px; overflow-y: auto;">
                            ${predictiveExtraction.predictedConcepts.map((concept, index) => `
                                <div style="margin-bottom: 12px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid ${getProbabilityColor(concept.probability)}; position: relative;">
                                    <div style="display: flex; justify-content: between; align-items: center;">
                                        <strong style="color: #581c87;">${concept.term}</strong>
                                        <span style="margin-left: auto; font-size: 0.9rem; font-weight: bold; color: ${getProbabilityColor(concept.probability)};">
                                            ${(concept.probability * 100).toFixed(1)}%
                                        </span>
                                    </div>
                                    <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                                        ç†ç”±: ${concept.reasoning}
                                    </div>
                                    <div style="background: #f3f4f6; border-radius: 4px; height: 4px; margin-top: 8px;">
                                        <div style="background: ${getProbabilityColor(concept.probability)}; height: 100%; border-radius: 4px; width: ${concept.probability * 100}%;"></div>
                                    </div>
                                    ${concept.emergenceIndicators && concept.emergenceIndicators.length > 0 ? `
                                        <div style="margin-top: 8px; font-size: 11px;">
                                            <strong>å‰µç™ºæŒ‡æ¨™:</strong> ${concept.emergenceIndicators.join(', ')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- å‰µç™ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¡¨ç¤º -->
                    <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 16px;">
                        <h3 style="color: #15803d; margin-bottom: 12px;">âš¡ å‰µç™ºãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${predictiveExtraction.emergentPatterns.map((pattern, index) => `
                                <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border-left: 3px solid #22c55e;">
                                    <div style="font-weight: bold; color: #15803d; font-size: 14px;">
                                        ${pattern}
                                    </div>
                                </div>
                            `).join('')}
                            ${predictiveExtraction.emergentPatterns.length === 0 ? `
                                <div style="text-align: center; color: #6b7280; font-style: italic; padding: 20px;">
                                    å‰µç™ºãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- éš ã‚ŒãŸæ¥ç¶šã®å¯è¦–åŒ– -->
                ${predictiveExtraction.hiddenConnections.length > 0 ? `
                    <div style="background: #fef2f2; border: 1px solid #f87171; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <h3 style="color: #dc2626; margin-bottom: 12px;">ğŸ”— éš ã‚ŒãŸæ¦‚å¿µé–“æ¥ç¶š</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px;">
                            ${predictiveExtraction.hiddenConnections.map(connection => `
                                <div style="padding: 8px; background: white; border-radius: 4px; font-size: 14px;">
                                    <span style="color: #dc2626; font-weight: bold;">${connection}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- Phase 3: æ–°æ¦‚å¿µæ¤œå‡ºã®è©³ç´° -->
                ${parentExtraction.newConceptDetection ? `
                    <div style="background: #f0f9ff; border: 1px solid #3b82f6; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <h3 style="color: #1d4ed8; margin-bottom: 12px;">ğŸ†• æ–°æ¦‚å¿µæ¤œå‡º</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: ${parentExtraction.newConceptDetection.hasNewConcepts ? '#059669' : '#6b7280'};">
                                    ${parentExtraction.newConceptDetection.hasNewConcepts ? 'âœ…' : 'â–'}
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">æ–°æ¦‚å¿µç™ºè¦‹</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #d97706;">${parentExtraction.newConceptDetection.newConceptCount}</div>
                                <div style="font-size: 12px; color: #6b7280;">æ–°æ¦‚å¿µæ•°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #7c3aed;">${parentExtraction.newConceptDetection.metaConceptCount}</div>
                                <div style="font-size: 12px; color: #6b7280;">ãƒ¡ã‚¿æ¦‚å¿µæ•°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #dc2626;">${parentExtraction.newConceptDetection.noveltyScore.toFixed(2)}/10</div>
                                <div style="font-size: 12px; color: #6b7280;">æ–°è¦æ€§ã‚¹ã‚³ã‚¢</div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- å“è³ªãƒ»æ€§èƒ½æŒ‡æ¨™ -->
                <div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px;">
                    <h3 style="color: #334155; margin-bottom: 12px;">ğŸ“Š Phase 3 æ€§èƒ½æŒ‡æ¨™</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.1rem; font-weight: bold; color: #059669;">${parentExtraction.processingTime}ms</div>
                            <div style="font-size: 12px; color: #6b7280;">å‡¦ç†æ™‚é–“</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.1rem; font-weight: bold; color: #d97706;">${parentExtraction.confidence.toFixed(1)}%</div>
                            <div style="font-size: 12px; color: #6b7280;">ç·åˆä¿¡é ¼åº¦</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.1rem; font-weight: bold; color: #7c3aed;">${predictiveExtraction.predictedConcepts.length}</div>
                            <div style="font-size: 12px; color: #6b7280;">äºˆæ¸¬æ¦‚å¿µæ•°</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.1rem; font-weight: bold; color: #dc2626;">${predictiveExtraction.analysisDepth || 3}</div>
                            <div style="font-size: 12px; color: #6b7280;">åˆ†ææ·±åº¦</div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Phase 3: ç¢ºç‡ã«åŸºã¥ãè‰²æ±ºå®š
         */
        function getProbabilityColor(probability) {
            if (probability >= 0.8) return '#059669'; // é«˜ç¢ºç‡ - ç·‘
            if (probability >= 0.6) return '#d97706'; // ä¸­ç¢ºç‡ - ã‚ªãƒ¬ãƒ³ã‚¸
            if (probability >= 0.4) return '#7c3aed'; // ä½ç¢ºç‡ - ç´«
            return '#6b7280'; // æœ€ä½ç¢ºç‡ - ã‚°ãƒ¬ãƒ¼
        }

        /**
         * å­¦ç¿’çµ±è¨ˆã®è¡¨ç¤º
         */
        async function displayLearningStats() {
            try {
                const response = await fetch('/api/learning/session-stats');
                const result = await response.json();
                
                const learningContent = document.getElementById('learning-content');
                
                if (result.success && result.stats) {
                    const stats = result.stats;
                    
                    learningContent.innerHTML = `
                        <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-radius: 12px;">
                            <h2 style="color: #065f46; margin-bottom: 16px; display: flex; align-items: center;">
                                ğŸ“š ã‚»ãƒƒã‚·ãƒ§ãƒ³å­¦ç¿’çµ±è¨ˆ - å®Ÿåˆ©ç”¨ãƒ‡ãƒ¼ã‚¿æ´»ç”¨
                                <span style="margin-left: auto; font-size: 1rem; font-weight: normal; color: #6b7280;">
                                    è‡ªå‹•å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ 
                                </span>
                            </h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div><strong>ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°:</strong> ${stats.totalSessions}å€‹</div>
                                <div><strong>ãƒ¦ãƒ‹ãƒ¼ã‚¯æ¦‚å¿µ:</strong> ${stats.uniqueConcepts}å€‹</div>
                                <div><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${stats.userPatterns}å€‹</div>
                                <div><strong>å¹³å‡é©æ–°åº¦:</strong> ${stats.averageInnovationLevel.toFixed(2)}/10</div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                            <!-- é »å‡ºæ¦‚å¿µãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
                            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px;">
                                <h3 style="color: #92400e; margin-bottom: 12px;">ğŸ† é »å‡ºæ¦‚å¿µãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
                                <div style="max-height: 400px; overflow-y: auto;">
                                    ${stats.topConcepts.map((concept, index) => `
                                        <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <strong style="color: #92400e;">${index + 1}. ${concept.concept}</strong>
                                                <span style="font-size: 0.9rem; color: #6b7280;">
                                                    ${concept.frequency}å› (ä¿¡é ¼åº¦: ${(concept.confidence * 100).toFixed(1)}%)
                                                </span>
                                            </div>
                                            <div style="background: #f3f4f6; border-radius: 4px; height: 4px; margin-top: 4px;">
                                                <div style="background: #f59e0b; height: 100%; border-radius: 4px; width: ${Math.min(100, concept.frequency * 10)}%;"></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${stats.topConcepts.length === 0 ? `
                                        <div style="text-align: center; color: #6b7280; font-style: italic; padding: 20px;">
                                            å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™
                                        </div>
                                    ` : ''}
                                </div>
                            </div>

                            <!-- å­¦ç¿’æ©Ÿèƒ½çŠ¶æ³ -->
                            <div style="background: #f0f9ff; border: 1px solid #3b82f6; border-radius: 8px; padding: 16px;">
                                <h3 style="color: #1d4ed8; margin-bottom: 12px;">âš™ï¸ å­¦ç¿’æ©Ÿèƒ½çŠ¶æ³</h3>
                                <div style="space-y: 12px;">
                                    <div style="margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                            <span style="font-weight: bold;">ã‚»ãƒƒã‚·ãƒ§ãƒ³å­¦ç¿’</span>
                                            <span style="color: ${result.features.sessionLearningEnabled ? '#059669' : '#dc2626'};">
                                                ${result.features.sessionLearningEnabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}
                                            </span>
                                        </div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            å®Ÿéš›ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¦‚å¿µäºˆæ¸¬ç²¾åº¦ã‚’å‘ä¸Š
                                        </div>
                                    </div>
                                    
                                    <div style="margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                            <span style="font-weight: bold;">äºˆæ¸¬çµ±åˆ</span>
                                            <span style="color: ${result.features.predictiveIntegration ? '#059669' : '#dc2626'};">
                                                ${result.features.predictiveIntegration ? 'âœ… çµ±åˆæ¸ˆã¿' : 'âŒ æœªçµ±åˆ'}
                                            </span>
                                        </div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            ã‚»ãƒƒã‚·ãƒ§ãƒ³å­¦ç¿’çµæœã‚’äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã«çµ±åˆ
                                        </div>
                                    </div>
                                    
                                    <div style="margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                            <span style="font-weight: bold;">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°</span>
                                            <span style="color: ${result.features.realTimeUpdates ? '#059669' : '#dc2626'};">
                                                ${result.features.realTimeUpdates ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}
                                            </span>
                                        </div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å­¦ç¿’
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å“è³ªãƒˆãƒ¬ãƒ³ãƒ‰ -->
                        ${stats.qualityTrends ? `
                            <div style="background: #fdf2f8; border: 1px solid #ec4899; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                                <h3 style="color: #831843; margin-bottom: 12px;">ğŸ“ˆ å“è³ªãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #059669;">${stats.qualityTrends.averageInnovationLevel.toFixed(2)}</div>
                                        <div style="font-size: 12px; color: #6b7280;">å¹³å‡é©æ–°åº¦</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #d97706;">${stats.qualityTrends.successPatterns?.length || 0}</div>
                                        <div style="font-size: 12px; color: #6b7280;">æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.2rem; font-weight: bold; color: #7c3aed;">${stats.qualityTrends.failurePatterns?.length || 0}</div>
                                        <div style="font-size: 12px; color: #6b7280;">æ”¹å–„è¦ç´ </div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <!-- æ´»ç”¨æ–¹æ³• -->
                        <div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #334155; margin-bottom: 12px;">ğŸ’¡ ã‚»ãƒƒã‚·ãƒ§ãƒ³å­¦ç¿’ã®æ´»ç”¨</h3>
                            <div style="font-size: 14px; color: #64748b; line-height: 1.6;">
                                <p style="margin-bottom: 8px;">â€¢ <strong>æ¦‚å¿µäºˆæ¸¬ç²¾åº¦å‘ä¸Š:</strong> å®Ÿéš›ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¦‚å¿µå‡ºç¾ã‚’äºˆæ¸¬</p>
                                <p style="margin-bottom: 8px;">â€¢ <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> å€‹åˆ¥ã®æ¦‚å¿µä½¿ç”¨å‚¾å‘ã‚’å­¦ç¿’ãƒ»é©å¿œ</p>
                                <p style="margin-bottom: 8px;">â€¢ <strong>å“è³ªç›¸é–¢åˆ†æ:</strong> é«˜å“è³ªã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç‰¹å¾´ã‚’ç‰¹å®šãƒ»æ´»ç”¨</p>
                                <p style="margin-bottom: 8px;">â€¢ <strong>æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰:</strong> æ¦‚å¿µã®æ™‚é–“çš„å¤‰åŒ–ãƒ»é€²åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½è·¡</p>
                                <p style="margin-bottom: 8px;">â€¢ <strong>è‡ªå‹•æ”¹å–„:</strong> ç¶™ç¶šä½¿ç”¨ã«ã‚ˆã‚Šäºˆæ¸¬ç²¾åº¦ãŒè‡ªå‹•çš„ã«å‘ä¸Š</p>
                            </div>
                        </div>
                    `;
                } else {
                    learningContent.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“š</div>
                            <h3 style="margin-bottom: 12px;">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰ä¸­...</h3>
                            <p>ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å­¦ç¿’ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚</p>
                            <div style="margin-top: 16px; font-size: 12px;">
                                ã‚¨ãƒ©ãƒ¼: ${result.error || 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³'}
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('å­¦ç¿’çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                const learningContent = document.getElementById('learning-content');
                learningContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc2626;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">âŒ</div>
                        <h3>å­¦ç¿’çµ±è¨ˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</h3>
                        <p>ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>
                    </div>
                `;
            }
        }


        function getInnovationColor(level) {
            if (level >= 9) return '#dc2626'; // èµ¤ï¼ˆé©å‘½çš„ï¼‰
            if (level >= 7) return '#d97706'; // ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆé«˜é©æ–°ï¼‰
            if (level >= 5) return '#059669'; // ç·‘ï¼ˆä¸­é©æ–°ï¼‰
            return '#6b7280'; // ã‚°ãƒ¬ãƒ¼ï¼ˆåŸºæœ¬ï¼‰
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½
        let currentSessionData = null;
        let lastProcessedResults = null;

        // saveCurrentSessioné–¢æ•°ã¯å‰Šé™¤ - saveProcessedSession()ã«çµ±åˆæ¸ˆã¿

        /**
         * æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆå¼•ãç¶™ãä»˜ãï¼‰
         */
        async function startNewSession() {
            const statusEl = document.getElementById('sessionStatus');
            statusEl.textContent = 'ğŸ”— æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³æº–å‚™ä¸­...';
            statusEl.style.color = '#0ea5e9';

            try {
                const response = await fetch('/api/sessions/start-new', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        useHandover: true
                    })
                });

                const result = await response.json();

                if (result.success) {
                    if (result.hasHandover && result.startPrompt) {
                        // å¼•ãç¶™ããƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿãƒ­ã‚°ã‚¨ãƒªã‚¢ã«è¨­å®š
                        document.getElementById('rawLog').value = result.startPrompt;
                        
                        // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ–‡è„ˆã‚¨ãƒªã‚¢ã«å¼•ãç¶™ãæƒ…å ±ã‚’è¨­å®š
                        const handover = result.handover;
                        document.getElementById('sessionContext').value = 
                            `å‰å›ã‚»ãƒƒã‚·ãƒ§ãƒ³å¼•ãç¶™ã (${handover.fromSessionId})\n` +
                            `ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${handover.keywords.join(', ')}\n` +
                            `æ¦‚è¦: ${handover.contextSummary}`;
                        
                        statusEl.innerHTML = `
                            âœ… å¼•ãç¶™ãã‚»ãƒƒã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†ï¼<br>
                            ğŸ”‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <strong>${handover.keywords.join(', ')}</strong><br>
                            ğŸ“ Claude/ChatGPTã«ä¸Šè¨˜ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦å¯¾è©±ã‚’é–‹å§‹ã—ã¦ãã ã•ã„
                        `;
                        statusEl.style.color = '#059669';
                        
                        // ç”Ÿãƒ­ã‚°ã‚¨ãƒªã‚¢ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                        document.getElementById('rawLog').scrollIntoView({ behavior: 'smooth' });
                        
                    } else {
                        // å¼•ãç¶™ããƒ‡ãƒ¼ã‚¿ãªã—
                        document.getElementById('rawLog').value = '';
                        document.getElementById('sessionContext').value = `æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ (${result.sessionId})`;
                        
                        statusEl.innerHTML = `
                            âœ… æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†ï¼<br>
                            ğŸ†” ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: <strong>${result.sessionId}</strong><br>
                            ğŸ’¬ æ–°ã—ã„å¯¾è©±ã‚’é–‹å§‹ã—ã¦ãã ã•ã„
                        `;
                        statusEl.style.color = '#059669';
                    }
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                statusEl.textContent = `âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹å¤±æ•—: ${error.message}`;
                statusEl.style.color = '#dc2626';
                console.error('æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * æœ€æ–°å¼•ãç¶™ããƒ‡ãƒ¼ã‚¿ç¢ºèª
         */
        async function getLatestHandover() {
            const statusEl = document.getElementById('sessionStatus');
            statusEl.textContent = 'ğŸ”„ å¼•ãç¶™ããƒ‡ãƒ¼ã‚¿ç¢ºèªä¸­...';
            statusEl.style.color = '#0ea5e9';

            try {
                const response = await fetch('/api/sessions/handover/latest');
                const result = await response.json();

                if (result.success) {
                    if (result.hasHandover) {
                        const handover = result.handover;
                        statusEl.innerHTML = `
                            âœ… å¼•ãç¶™ããƒ‡ãƒ¼ã‚¿ã‚ã‚Šï¼<br>
                            ğŸ”‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <strong>${handover.keywords.join(', ')}</strong><br>
                            ğŸ“Š å“è³ª: <strong>${handover.qualityScore}%</strong><br>
                            ğŸ“ ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹: ${handover.guidance.substring(0, 50)}...
                        `;
                        statusEl.style.color = '#059669';
                    } else {
                        statusEl.textContent = 'ğŸ“­ å¼•ãç¶™ãå¯èƒ½ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“';
                        statusEl.style.color = '#6b7280';
                    }
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                statusEl.textContent = `âŒ å¼•ãç¶™ãç¢ºèªå¤±æ•—: ${error.message}`;
                statusEl.style.color = '#dc2626';
                console.error('å¼•ãç¶™ãç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
         */
        async function showSessionDashboard() {
            try {
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆã‚’å–å¾—
                const statsResponse = await fetch('/api/sessions/stats');
                const statsResult = await statsResponse.json();

                if (statsResult.success) {
                    await updateSessionManagementTab(statsResult.stats);
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    document.querySelector('[onclick="switchTab(\'sessions\')"]').classList.add('active');
                    document.getElementById('sessions-content').classList.add('active');
                    
                    // çµæœã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
                    document.getElementById('results').style.display = 'block';
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                showError('ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚¿ãƒ–ã®å†…å®¹ã‚’æ›´æ–°
         */
        async function updateSessionManagementTab(stats = null) {
            const sessionsContent = document.getElementById('sessions-content');
            
            // çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ï¼ˆæœªå–å¾—ã®å ´åˆï¼‰
            if (!stats) {
                try {
                    const response = await fetch('/api/sessions/stats');
                    const result = await response.json();
                    if (result.success) {
                        stats = result.stats;
                    }
                } catch (error) {
                    console.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            if (stats) {
                sessionsContent.innerHTML = `
                    <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px;">
                        <h2 style="color: #0c4a6e; margin-bottom: 16px;">ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                            <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0ea5e9;">${stats.totalSessions}</div>
                                <div style="font-size: 12px; color: #6b7280;">ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #059669;">${stats.averageQuality}%</div>
                                <div style="font-size: 12px; color: #6b7280;">å¹³å‡å“è³ª</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #d97706;">${Object.keys(stats.phaseDistribution).length}</div>
                                <div style="font-size: 12px; color: #6b7280;">ãƒ•ã‚§ãƒ¼ã‚ºæ•°</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #7c3aed;">${Object.keys(stats.tagDistribution).length}</div>
                                <div style="font-size: 12px; color: #6b7280;">ã‚¿ã‚°æ•°</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
                        <!-- ãƒ•ã‚§ãƒ¼ã‚ºåˆ†å¸ƒ -->
                        <div style="background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #065f46; margin-bottom: 12px;">ğŸ“Š ãƒ•ã‚§ãƒ¼ã‚ºåˆ†å¸ƒ</h3>
                            ${Object.entries(stats.phaseDistribution).map(([phase, count]) => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px;">
                                    <span><strong>${phase}</strong></span>
                                    <span style="color: #059669; font-weight: bold;">${count}å€‹</span>
                                </div>
                            `).join('')}
                        </div>

                        <!-- ã‚¿ã‚°åˆ†å¸ƒ -->
                        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px;">
                            <h3 style="color: #92400e; margin-bottom: 12px;">ğŸ·ï¸ ã‚¿ã‚°åˆ†å¸ƒ</h3>
                            ${Object.entries(stats.tagDistribution).slice(0, 10).map(([tag, count]) => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px; padding: 6px; background: white; border-radius: 4px; font-size: 14px;">
                                    <span>${tag}</span>
                                    <span style="color: #d97706; font-weight: bold;">${count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                        <h3 style="color: #334155; margin-bottom: 12px;">ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="startNewSession()">
                                ğŸ”— æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
                            </button>
                            <button class="btn btn-secondary" onclick="getLatestHandover()">
                                ğŸ”„ å¼•ãç¶™ãç¢ºèª
                            </button>
                            <button class="btn btn-secondary" onclick="loadSessionList()">
                                ğŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§
                            </button>
                            <button class="btn btn-secondary" onclick="searchSessions()">
                                ğŸ” ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢
                            </button>
                        </div>
                    </div>

                    <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚¨ãƒªã‚¢ -->
                    <div id="sessionListArea" style="display: none;">
                        <div style="background: #fef7ff; border: 1px solid #a855f7; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <h3 style="color: #7e22ce; margin-bottom: 12px;">ğŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§</h3>
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <input type="text" id="sessionSearchInput" placeholder="ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢..." style="flex: 1; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                                <button class="btn btn-secondary" onclick="filterSessions()">ğŸ” æ¤œç´¢</button>
                                <button class="btn btn-secondary" onclick="hideSessionList()">âœ• é–‰ã˜ã‚‹</button>
                            </div>
                            <div id="sessionListContent" style="max-height: 400px; overflow-y: auto;">
                                <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                            </div>
                        </div>
                    </div>

                    <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã‚¨ãƒªã‚¢ -->
                    <div id="sessionDetailArea" style="display: none;">
                        <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h3 style="color: #15803d;">ğŸ“„ ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°</h3>
                                <button class="btn btn-secondary" onclick="hideSessionDetail()">âœ• é–‰ã˜ã‚‹</button>
                            </div>
                            <div id="sessionDetailContent">
                                <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                            </div>
                        </div>
                    </div>
                `;
            } else {
                sessionsContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <h3>ğŸ“­ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãªã—</h3>
                        <p>ã¾ã ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>å¯¾è©±ãƒ­ã‚°ã‚’ä¿å­˜ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ã€‚</p>
                        <button class="btn btn-primary" onclick="alert('å¯¾è©±ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦çµ±ä¸€å‡¦ç†ã‚’å®Ÿè¡Œå¾Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™')" style="margin-top: 16px;">
                            ğŸ’¡ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã®ä½¿ã„æ–¹
                        </button>
                    </div>
                `;
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§è¡¨ç¤º
         */
        async function loadSessionList() {
            const sessionListArea = document.getElementById('sessionListArea');
            const sessionListContent = document.getElementById('sessionListContent');
            
            try {
                // å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—ï¼ˆæ¤œç´¢API ã‚’ç©ºã§å®Ÿè¡Œï¼‰
                const response = await fetch('/api/sessions/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        keywords: []
                    })
                });

                const result = await response.json();
                if (result.success) {
                    const sessions = result.sessions || [];
                    
                    if (sessions.length === 0) {
                        sessionListContent.innerHTML = '<p style="text-align: center; color: #6b7280;">ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
                    } else {
                        sessionListContent.innerHTML = sessions.map(session => `
                            <div style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px; margin-bottom: 8px; background: white; cursor: pointer; transition: background-color 0.2s;" 
                                 onclick="loadSessionDetail('${session.id}')" 
                                 onmouseover="this.style.backgroundColor='#f9fafb'" 
                                 onmouseout="this.style.backgroundColor='white'">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <strong style="color: #1f2937;">${session.filename || session.id}</strong>
                                    <span style="font-size: 12px; color: #6b7280;">${new Date(session.timestamp).toLocaleString()}</span>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">
                                    ID: ${session.id}
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <span style="background: ${getPhaseColor(session.phase)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">
                                        ${session.phase}
                                    </span>
                                    <span style="background: ${getInnovationColor(session.innovationLevel)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">
                                        é©æ–°åº¦ ${session.innovationLevel}/10
                                    </span>
                                    <span style="background: ${session.isReliable ? '#10b981' : '#ef4444'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">
                                        ${session.isReliable ? 'ä¿¡é ¼æ€§é«˜' : 'è¦æ”¹å–„'}
                                    </span>
                                </div>
                                <div style="margin-top: 6px; font-size: 11px; color: #9ca3af;">
                                    ã‚¿ã‚°: ${session.tags ? session.tags.slice(0, 3).join(', ') : 'ãªã—'}${session.tags && session.tags.length > 3 ? '...' : ''}
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    sessionListArea.style.display = 'block';
                    sessionListArea.scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                showError('ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°è¡¨ç¤º
         */
        async function loadSessionDetail(sessionId) {
            const sessionDetailArea = document.getElementById('sessionDetailArea');
            const sessionDetailContent = document.getElementById('sessionDetailContent');
            
            try {
                const response = await fetch(`/api/sessions/${sessionId}`);
                const result = await response.json();
                
                if (result.success) {
                    const session = result.session;
                    const analysis = session.analysis;
                    
                    sessionDetailContent.innerHTML = `
                        <div style="margin-bottom: 16px;">
                            <h4 style="color: #1f2937; margin-bottom: 8px;">åŸºæœ¬æƒ…å ±</h4>
                            <div style="background: #f9fafb; padding: 12px; border-radius: 6px;">
                                <div style="margin-bottom: 4px;"><strong>ID:</strong> ${session.id}</div>
                                <div style="margin-bottom: 4px;"><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${session.filename}</div>
                                <div style="margin-bottom: 4px;"><strong>ä½œæˆæ—¥æ™‚:</strong> ${new Date(session.timestamp).toLocaleString()}</div>
                                <div style="margin-bottom: 4px;"><strong>ãƒ•ã‚§ãƒ¼ã‚º:</strong> <span style="background: ${getPhaseColor(session.phase)}; color: white; padding: 2px 8px; border-radius: 4px;">${session.phase}</span></div>
                                <div style="margin-bottom: 4px;"><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${session.status}</div>
                            </div>
                        </div>

                        ${analysis ? `
                            <div style="margin-bottom: 16px;">
                                <h4 style="color: #1f2937; margin-bottom: 8px;">åˆ†æçµæœ</h4>
                                <div style="background: #f0f9ff; padding: 12px; border-radius: 6px;">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 12px;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.2rem; font-weight: bold; color: ${getInnovationColor(analysis.innovationLevel)};">${analysis.innovationLevel}/10</div>
                                            <div style="font-size: 11px; color: #6b7280;">é©æ–°åº¦</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.2rem; font-weight: bold; color: ${analysis.isReliable ? '#10b981' : '#ef4444'};">${analysis.qualityScore}%</div>
                                            <div style="font-size: 11px; color: #6b7280;">å“è³ªã‚¹ã‚³ã‚¢</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.2rem; font-weight: bold; color: #7c3aed;">${analysis.dialogueType}</div>
                                            <div style="font-size: 11px; color: #6b7280;">å¯¾è©±ã‚¿ã‚¤ãƒ—</div>
                                        </div>
                                    </div>
                                    ${analysis.deepConcepts && analysis.deepConcepts.length > 0 ? `
                                        <div style="margin-top: 12px;">
                                            <strong>æ·±å±¤æ¦‚å¿µ:</strong>
                                            <div style="margin-top: 4px;">
                                                ${analysis.deepConcepts.map(concept => `
                                                    <span style="background: #ec4899; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; margin-right: 4px; margin-bottom: 2px; display: inline-block;">${concept.term}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                    ${analysis.continuityKeywords && analysis.continuityKeywords.length > 0 ? `
                                        <div style="margin-top: 8px;">
                                            <strong>ç¶™ç¶šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> ${analysis.continuityKeywords.join(', ')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}

                        <div style="margin-bottom: 16px;">
                            <h4 style="color: #1f2937; margin-bottom: 8px;">ã‚¿ã‚°</h4>
                            <div style="background: #fef3c7; padding: 12px; border-radius: 6px;">
                                ${session.tags && session.tags.length > 0 ? 
                                    session.tags.map(tag => `
                                        <span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 4px; margin-bottom: 2px; display: inline-block;">${tag}</span>
                                    `).join('') : 
                                    '<span style="color: #6b7280;">ã‚¿ã‚°ãªã—</span>'
                                }
                            </div>
                        </div>

                        <div style="margin-bottom: 16px;">
                            <h4 style="color: #1f2937; margin-bottom: 8px;">ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…å®¹</h4>
                            <div style="background: #f3f4f6; padding: 12px; border-radius: 6px; max-height: 200px; overflow-y: auto;">
                                <pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px; margin: 0;">${escapeHtml(session.content)}</pre>
                            </div>
                        </div>

                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="continueFromSession('${session.id}')">
                                ğŸ”— ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ç¶™ç¶š
                            </button>
                            <button class="btn btn-secondary" onclick="copySessionContent('${session.id}')">
                                ğŸ“‹ å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼
                            </button>
                        </div>
                    `;
                    
                    sessionDetailArea.style.display = 'block';
                    sessionDetailArea.scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                showError('ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        /**
         * ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢ï¼ˆç°¡æ˜“ç‰ˆï¼‰
         */
        async function searchSessions() {
            const keyword = prompt('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (!keyword) return;

            try {
                const response = await fetch('/api/sessions/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        keywords: [keyword]
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`æ¤œç´¢çµæœ: ${result.count}ä»¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
                    console.log('æ¤œç´¢çµæœ:', result.sessions);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                showError('ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function getPhaseColor(phase) {
            const colors = {
                'discovery': '#dc2626',
                'development': '#d97706', 
                'exploration': '#7c3aed',
                'basic': '#6b7280',
                'unknown': '#6b7280'
            };
            return colors[phase] || '#6b7280';
        }

        function hideSessionList() {
            document.getElementById('sessionListArea').style.display = 'none';
        }

        function hideSessionDetail() {
            document.getElementById('sessionDetailArea').style.display = 'none';
        }

        function filterSessions() {
            const searchInput = document.getElementById('sessionSearchInput');
            const keyword = searchInput ? searchInput.value.trim() : '';
            
            if (!keyword) {
                loadSessionList(); // å…¨ä»¶å†è¡¨ç¤º
                return;
            }
            
            // ç°¡æ˜“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®Ÿè£…
            alert(`æ¤œç´¢æ©Ÿèƒ½ã¯æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å¼·åŒ–äºˆå®šã§ã™\nç¾åœ¨ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: "${keyword}"`);
        }

        async function continueFromSession(sessionId) {
            try {
                const response = await fetch(`/api/sessions/${sessionId}`);
                const result = await response.json();
                
                if (result.success) {
                    const session = result.session;
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…å®¹ã‚’å…¥åŠ›ã‚¨ãƒªã‚¢ã«è¨­å®š
                    document.getElementById('rawLog').value = session.content;
                    document.getElementById('sessionContext').value = `ç¶™ç¶šã‚»ãƒƒã‚·ãƒ§ãƒ³ (${sessionId})`;
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã‚’é–‰ã˜ã‚‹
                    hideSessionDetail();
                    
                    // å…¥åŠ›ã‚¨ãƒªã‚¢ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    document.getElementById('rawLog').scrollIntoView({ behavior: 'smooth' });
                    
                    alert(`ã‚»ãƒƒã‚·ãƒ§ãƒ³ ${sessionId} ã‹ã‚‰ç¶™ç¶šé–‹å§‹ã—ã¾ã—ãŸ`);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert(`ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶™ç¶šã«å¤±æ•—: ${error.message}`);
            }
        }

        async function copySessionContent(sessionId) {
            try {
                const response = await fetch(`/api/sessions/${sessionId}`);
                const result = await response.json();
                
                if (result.success) {
                    const content = result.session.content;
                    
                    if (navigator.clipboard) {
                        await navigator.clipboard.writeText(content);
                        alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…å®¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è¨­å®š
                        document.getElementById('rawLog').value = content;
                        alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…å®¹ã‚’å…¥åŠ›ã‚¨ãƒªã‚¢ã«è¨­å®šã—ã¾ã—ãŸ');
                    }
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                alert(`ã‚³ãƒ”ãƒ¼ã«å¤±æ•—: ${error.message}`);
            }
        }

        /**
         * çµ±ä¸€å‡¦ç†å®Œäº†å¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
         */
        function showSessionSaveOption(result) {
            const sessionStatus = document.getElementById('sessionStatus');
            
            // å“è³ªã‚¹ã‚³ã‚¢ã¨é©æ–°åº¦ã‚’å–å¾—
            const qualityScore = result.extraction ? result.extraction.confidence : 50;
            const innovationLevel = result.extraction ? result.extraction.predictedInnovationLevel : 5;
            
            sessionStatus.innerHTML = `
                <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; padding: 12px; margin-top: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <strong style="color: #15803d;">âœ… çµ±ä¸€å‡¦ç†å®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜å¯èƒ½</strong>
                        <div style="display: flex; gap: 8px;">
                            <span style="background: ${getInnovationColor(innovationLevel)}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px;">
                                é©æ–°åº¦ ${innovationLevel}/10
                            </span>
                            <span style="background: ${qualityScore >= 70 ? '#10b981' : '#ef4444'}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px;">
                                å“è³ª ${qualityScore}%
                            </span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button class="btn btn-primary" onclick="saveProcessedSession()" style="font-size: 12px; padding: 6px 12px;">
                            ğŸ’¾ å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
                        </button>
                        <span style="color: #6b7280; font-size: 12px;">
                            é‡è¤‡å‡¦ç†ãªã—ãƒ»é«˜é€Ÿä¿å­˜
                        </span>
                    </div>
                </div>
            `;
        }

        /**
         * å‡¦ç†æ¸ˆã¿çµæœã‚’ä½¿ã£ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ï¼ˆé‡è¤‡å‡¦ç†ãªã—ï¼‰
         */
        async function saveProcessedSession() {
            if (!lastProcessedResults) {
                showError('ä¿å­˜ã™ã‚‹å‡¦ç†çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«çµ±ä¸€å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // é‡è¤‡ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢
            const saveButton = document.querySelector('button[onclick="saveProcessedSession()"]');
            if (saveButton.disabled) {
                console.log('ğŸ”’ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã¯æ—¢ã«å®Ÿè¡Œä¸­ã§ã™');
                return;
            }
            
            const rawLog = document.getElementById('rawLog').value.trim();
            const sessionContext = document.getElementById('sessionContext').value.trim();
            
            if (!rawLog) {
                showError('å¯¾è©±ãƒ­ã‚°ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ãƒ»ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´
            saveButton.disabled = true;
            const originalText = saveButton.textContent;
            saveButton.textContent = 'ğŸ’¾ ä¿å­˜ä¸­...';

            const sessionStatus = document.getElementById('sessionStatus');
            sessionStatus.innerHTML = '<div style="color: #0ea5e9; padding: 8px;">ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ä¸­...</div>';

            try {
                // ãƒ‡ãƒãƒƒã‚°: lastProcessedResults ã®å†…å®¹ã‚’ç¢ºèª
                console.log('ğŸ” lastProcessedResults æ§‹é€ :', {
                    hasExtraction: !!lastProcessedResults.extraction,
                    hasUnified: !!lastProcessedResults.unified,
                    hasMetrics: !!lastProcessedResults.metrics,
                    unifiedKeys: lastProcessedResults.unified ? Object.keys(lastProcessedResults.unified) : null
                });
                
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ30ç§’ï¼‰
                const controller = new AbortController();
                const timeoutId = setTimeout(() => {
                    controller.abort();
                    console.log('â° ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ');
                }, 30000);

                const response = await fetch('/api/sessions/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal,
                    body: JSON.stringify({
                        content: rawLog + (sessionContext ? '\n\n## ã‚»ãƒƒã‚·ãƒ§ãƒ³æ–‡è„ˆ\n' + sessionContext : ''),
                        preProcessedResults: {
                            conceptExtraction: lastProcessedResults.extraction,
                            unifiedProcessing: lastProcessedResults.unified,
                            qualityMetrics: lastProcessedResults.metrics
                        },
                        options: {
                            customTags: ['web-session', 'processed'],
                            skipReprocessing: true, // é‡è¤‡å‡¦ç†ã‚’å›é¿
                            usePreProcessedData: true
                        }
                    })
                });

                clearTimeout(timeoutId);
                const result = await response.json();

                if (result.success) {
                    const session = result.session;
                    sessionStatus.innerHTML = `
                        <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; padding: 12px;">
                            <div style="color: #15803d; font-weight: bold; margin-bottom: 8px;">
                                âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜å®Œäº†ï¼
                            </div>
                            <div style="font-size: 12px; color: #374151;">
                                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«: <strong>${session.filename}</strong><br>
                                ğŸ“Š å“è³ª: <strong>${session.qualityScore}%</strong> (é©æ–°åº¦: ${session.innovationLevel}/10)<br>
                                ğŸš€ ID: <code>${session.id}</code>
                            </div>
                            <div style="margin-top: 8px;">
                                <button class="btn btn-secondary" onclick="showSessionDashboard()" style="font-size: 11px; padding: 4px 8px;">
                                    ğŸ“Š ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã§ç¢ºèª
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
                    currentSessionData = session;
                    
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    sessionStatus.innerHTML = `<div style="color: #dc2626; padding: 8px;">â° ä¿å­˜ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 30ç§’ä»¥å†…ã«å®Œäº†ã—ã¾ã›ã‚“ã§ã—ãŸ</div>`;
                } else {
                    sessionStatus.innerHTML = `<div style="color: #dc2626; padding: 8px;">âŒ ä¿å­˜å¤±æ•—: ${error.message}</div>`;
                }
                console.error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            } finally {
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’å¿…ãšå¾©å…ƒ
                saveButton.disabled = false;
                saveButton.textContent = originalText;
            }
        }

        /**
         * AIçµ±åˆåˆ†ææ©Ÿèƒ½ï¼ˆPhase 5ï¼‰
         */
        async function runAIAnalysis() {
            const logContent = document.getElementById('rawLog').value.trim();
            if (!logContent) {
                showError('åˆ†æã™ã‚‹ãƒ­ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const analysisType = document.getElementById('aiAnalysisType').value;
            const providers = Array.from(document.querySelectorAll('input[name="aiProvider"]:checked')).map(cb => cb.value);
            
            if (providers.length === 0) {
                showError('åˆ†æã«ä½¿ç”¨ã™ã‚‹AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const aiAnalysisContent = document.getElementById('ai-analysis-content');
            aiAnalysisContent.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6b7280;">
                    <div class="spinner"></div>
                    <p>AIåˆ†æå®Ÿè¡Œä¸­... (${providers.join(', ')})</p>
                </div>
            `;

            try {
                const response = await fetch('/api/ai/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        logContent,
                        analysisType,
                        providers,
                        options: {
                            compareResults: providers.length > 1,
                            temperature: 0.3,
                            maxTokens: 2000
                        }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    displayAIAnalysisResults(result.result);
                } else {
                    showError('AIåˆ†æã‚¨ãƒ©ãƒ¼: ' + result.error);
                }

            } catch (error) {
                showError('AIåˆ†æãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—: ' + error.message);
            }
        }

        function displayAIAnalysisResults(result) {
            const content = document.getElementById('ai-analysis-content');
            
            let html = `
                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                    <h3 style="color: #1e293b; margin: 0 0 12px 0;">ğŸ¤– AIçµ±åˆåˆ†æçµæœ</h3>
                    <div style="display: flex; gap: 16px; font-size: 14px; color: #64748b;">
                        <span>åˆ†æã‚¿ã‚¤ãƒ—: <strong>${result.analysisType}</strong></span>
                        <span>å‡¦ç†æ™‚é–“: <strong>${result.processingTime}ms</strong></span>
                        <span>ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼: <strong>${result.results.length}å€‹</strong></span>
                    </div>
                </div>
            `;

            // å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®çµæœã‚’è¡¨ç¤º
            result.results.forEach((providerResult, index) => {
                const isSuccess = !providerResult.content.startsWith('Error:');
                
                html += `
                    <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 16px; overflow: hidden;">
                        <div style="background: ${isSuccess ? '#f1f5f9' : '#fef2f2'}; padding: 12px; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0; color: #1e293b;">
                                    ${isSuccess ? 'âœ…' : 'âŒ'} ${providerResult.provider.toUpperCase()} (${providerResult.model})
                                </h4>
                                <div style="font-size: 12px; color: #64748b;">
                                    ${providerResult.processingTime}ms
                                    ${providerResult.usage ? ` | ${providerResult.usage.totalTokens} tokens` : ''}
                                </div>
                            </div>
                        </div>
                        <div style="padding: 16px;">
                            <pre style="white-space: pre-wrap; font-family: system-ui; font-size: 14px; line-height: 1.6; margin: 0; color: ${isSuccess ? '#374151' : '#dc2626'};">${providerResult.content}</pre>
                        </div>
                    </div>
                `;
            });

            // æ¯”è¼ƒçµæœãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
            if (result.comparison) {
                html += `
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-top: 16px;">
                        <h4 style="color: #0c4a6e; margin: 0 0 12px 0;">ğŸ” ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¯”è¼ƒåˆ†æ</h4>
                        <div style="font-size: 14px; color: #0c4a6e;">
                            <p><strong>æ¨å¥¨çµæœ:</strong> ${result.comparison.bestResult}</p>
                            <p><strong>å…±é€šè¦ç´ :</strong> ${result.comparison.consensusPoints.join(', ')}</p>
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        async function loadAIProviders() {
            try {
                const response = await fetch('/api/ai/providers');
                const result = await response.json();
                
                if (result.success) {
                    updateAIProviderList(result.providers, result.stats);
                }
            } catch (error) {
                console.error('AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±å–å¾—å¤±æ•—:', error);
            }
        }

        function updateAIProviderList(providers, stats) {
            const container = document.getElementById('aiProviderContainer');
            if (!container) return;

            let html = '';
            providers.forEach(provider => {
                const stat = stats[provider] || {};
                const available = stat.available !== false;
                
                html += `
                    <label style="display: flex; align-items: center; margin-bottom: 8px; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; ${available ? '' : 'opacity: 0.5;'}">
                        <input type="checkbox" name="aiProvider" value="${provider}" ${available ? '' : 'disabled'} style="margin-right: 8px;">
                        <span style="font-weight: 500;">${provider.toUpperCase()}</span>
                        <span style="margin-left: auto; font-size: 12px; color: #6b7280;">
                            ${available ? 'ğŸŸ¢ åˆ©ç”¨å¯èƒ½' : 'ğŸ”´ åˆ©ç”¨ä¸å¯'}
                        </span>
                    </label>
                `;
            });

            container.innerHTML = html;
        }

        // AIåˆ†æã‚¿ãƒ–åˆæœŸåŒ–æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°
        function initializeAIAnalysisTab() {
            const content = document.getElementById('ai-analysis-content');
            
            content.innerHTML = `
                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #1e293b; margin: 0 0 16px 0;">ğŸ¤– AIçµ±åˆåˆ†æã‚·ã‚¹ãƒ†ãƒ  (Phase 5)</h3>
                    <p style="color: #64748b; margin: 0 0 16px 0;">è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦å¯¾è©±ãƒ­ã‚°ã‚’åˆ†æã—ã€æ¯”è¼ƒçµæœã‚’æä¾›ã—ã¾ã™ã€‚</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">åˆ†æã‚¿ã‚¤ãƒ—:</label>
                            <select id="aiAnalysisType" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                                <option value="concept-extraction">æ¦‚å¿µæŠ½å‡º</option>
                                <option value="quality-assessment">å“è³ªè©•ä¾¡</option>
                                <option value="continuation-suggestion">ç¶™ç¶šææ¡ˆ</option>
                                <option value="comparative-analysis">æ¯”è¼ƒåˆ†æ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼:</label>
                            <div id="aiProviderContainer" style="max-height: 120px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 4px; padding: 8px;">
                                <div style="text-align: center; color: #6b7280; padding: 20px;">èª­ã¿è¾¼ã¿ä¸­...</div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="runAIAnalysis()" class="btn btn-primary" style="background: #4f46e5;">
                        ğŸš€ AIåˆ†æã‚’å®Ÿè¡Œ
                    </button>
                </div>
                
                <div style="color: #6b7280; text-align: center; padding: 40px;">
                    AIåˆ†æã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </div>
            `;

            // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã¿
            loadAIProviders();
        }


        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('æ§‹é€ çš„å¯¾è©±ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†');
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸçŠ¶æ…‹ç¢ºèª
            getLatestHandover();
        });
    </script>
</body>
</html>